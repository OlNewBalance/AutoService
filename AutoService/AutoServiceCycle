namespace AutoService;

public class AutoServiceCycle
{
    AutoService _autoService;
    AutoChecker _autoChecker;
    MathCalcs _mathCalcs;
    Auto _auto;

    public AutoServiceCycle(AutoService autoService, AutoChecker autoChecker, MathCalcs mathCalcs)
    {
        _mathCalcs = mathCalcs;
        _autoService = autoService;
        _autoChecker = autoChecker;
        _auto = new Auto(false, false,false,false,
            false, 45);
    }
    public void Start()
    {
        while (true)
        {
            Console.WriteLine("Добро пожаловать в автосервис! Чтобы начать нажмите ENTER.");
            if (Console.ReadLine() == "") ;
            {
                _autoService.AutosRenderer(AutoService.AutoQueue);
                Console.WriteLine($"В автосервис подъехало {_autoService.QueueOfAuto.Count} машин!");
                Console.WriteLine("Обслужить??? ENTER.");
                if (Console.ReadLine() == "") ;
                {
                    if (_autoService.QueueOfAuto == null || _autoService.QueueOfAuto.Count == 0)
                    {
                        Console.WriteLine("Очередь машин пуста!");
                        return;
                    }

                    for (int i = 0; i < _autoService.QueueOfAuto.Count; i++)
                    {
                        Console.WriteLine($"Обслуживаем {i + 1}-ю машину!");

                        // Для Queue используем ElementAt или ToArray()
                        var currentAuto = _autoService.QueueOfAuto.ElementAt(i);
                        _autoChecker.AcceptCar(currentAuto);
                        Console.WriteLine($"Бюджет:{_autoService.Balance}");
                        Console.WriteLine("Состояние склада:");
                        foreach (var autoElements in _autoService.ElementsStorage)
                        {
                            Console.WriteLine(autoElements);
                        }

                        Console.WriteLine("Закупиться запчастями? Y/Enter");
                        if (Console.ReadLine() == "Y")
                        {
                            // Радио
                            Console.WriteLine("Сколько радио?");
                            string radioInput = Console.ReadLine();
                            if (!string.IsNullOrEmpty(radioInput))
                            {
                                _autoService.ToAddRadio = Convert.ToInt32(radioInput); // Используем radioInput!
                            }

                            Console.WriteLine("Enter");
                            Console.ReadLine();

                            // Колеса
                            Console.WriteLine("Сколько колес?");
                            string wheelInput = Console.ReadLine();
                            if (!string.IsNullOrEmpty(wheelInput))
                            {
                                _autoService.ToAddWheel = Convert.ToInt32(wheelInput); // Используем wheelInput!
                            }

                            // Карбюраторы
                            Console.WriteLine("Сколько карбюраторов?");
                            string carbureatorInput = Console.ReadLine();
                            if (!string.IsNullOrEmpty(carbureatorInput))
                            {
                                _autoService.ToAddCarbureator = Convert.ToInt32(carbureatorInput);
                            }

                            // Двигатели
                            Console.WriteLine("Сколько двигателей?");
                            string engineInput = Console.ReadLine();
                            if (!string.IsNullOrEmpty(engineInput))
                            {
                                _autoService.ToAddEngine = Convert.ToInt32(engineInput);
                            }

                            // Фары
                            Console.WriteLine("Сколько фар?");
                            string headInput = Console.ReadLine();
                            if (!string.IsNullOrEmpty(headInput))
                            {
                                _autoService.ToAddHeadlights = Convert.ToInt32(headInput);
                            }

                            int buyExpenses = _mathCalcs.ExpensesCalc(
                                _autoService.ToAddRadio,
                                _autoService.ToAddWheel,
                                _autoService.ToAddCarbureator,
                                _autoService.ToAddEngine,
                                _autoService.ToAddHeadlights
                            );

                            Console.WriteLine("Enter");

                            if (_autoService.Balance >= buyExpenses)
                            {
                                _autoService.AutoElementsRenderer(1, _autoService.ToAddWheel);
                                _autoService.AutoElementsRenderer(2, _autoService.ToAddEngine);
                                _autoService.AutoElementsRenderer(3, _autoService.ToAddHeadlights);
                                _autoService.AutoElementsRenderer(4, _autoService.ToAddRadio);
                                _autoService.AutoElementsRenderer(5, _autoService.ToAddCarbureator);
                                _autoService.Balance -= buyExpenses;
                                Console.WriteLine($"Было потрачено - {buyExpenses}");
                            }
                            else if (_autoService.Balance < buyExpenses)
                            {
                                Console.WriteLine($"Вам не хватает - {buyExpenses}");
                            }
                        }

                        Console.WriteLine("Нажмите ENTER для продолжения...");
                    }

                    Console.WriteLine("Все машины обслужены!");
                }
            }
        }
    }
}
